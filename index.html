<!DOCTYPE html>
<meta charset="utf-8">

<head>
	
	<link rel="stylesheet" type="text/css" href="main.css">
	<!-- Plotly.js -->
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
	<script src="//d3js.org/d3.v3.min.js"></script>
</head>

<body>
	<div id="div-1">
		<div id="main-graph"></div>
		<div id="filter">
			<p>
			  Substring:<br>
			  <input type="text" id="substring">
			  <button onclick="search()">Search</button>
			</p>
		</div>
	</div>
	<script>
		function search(){
			Plotly.d3.csv('movie_metadata.csv', function(err, rows){
				function unpack(rows, key) {
					return rows.map(function(row) { return row[key]; });
				}
				var substring=document.getElementById("substring").value;
				var rowsFiltered = rows.filter(function(row) {
					return row.movie_title.toLowerCase().includes(substring.toLowerCase());
				});
				if (substring===""){
					substring="Any";	
				} 
				var data = [
				{
					name: substring,
					type: 'scatter',
					x: unpack(rowsFiltered, 'duration'),
					y: unpack(rowsFiltered, 'imdb_score'),
					mode: 'lines+markers',		      
					text: unpack(rowsFiltered, 'movie_title'),
					marker: { size: 12 }
				}];
				var layout = {
					xaxis: {title: 'Duration [min]'},
					yaxis: {title: 'Score [1 to 10]'},
					margin: {t: 20},
					hovermode: 'closest'
				};
				Plotly.plot('main-graph', data, layout);
			});
		}
		search();
		window.onresize = function() {
			Plotly.Plots.resize(d3.select('#main-graph').node());
		};
	</script>
</body>
